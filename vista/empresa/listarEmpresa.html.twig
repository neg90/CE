{% extends "basePrivada.html.twig" %}
 
{% block title %} Lista de Empresas {% endblock %}
{% block contenedor %}   
    <h3 id="tituloBloque">Listado de Empresas</h3>
    <div class="clearfix"></div>

   <div class="row fila-de-alerta">
      <div class=" col-lg-2"></div>
         <div class=" col-lg-8">
          {% if aviso == 1 %}
            <div class="alert alert-success alert-dismissable">
                <button type="button" class="close" data-dismiss="alert">×</button>
                <strong>Perfecto!</strong> la empresa fue eliminada correctamente.
              </div>
            {% elseif  aviso == 2 %}
              <div class="alert alert-danger alert-dismissable">
                <button type="button" class="close" data-dismiss="alert">×</button>
                <strong>Error!</strong> No se pudo eliminar la empresa
              </div>
            {% endif %}
         </div>
  </div>
  <h5 id="referenciasRol">
    <span class="glyphicon glyphicon-tag" style="font-size:10px" aria-hidden="true"></span>
      Referencias
      <small>
        [<span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>=Modificar Correos, <span class="glyphicon glyphicon-home" aria-hidden="true"></span>=Modificar domicilios,<span class="glyphicon glyphicon-earphone" aria-hidden="true"></span>=Modificar telefonos, <span class="glyphicon glyphicon-user" aria-hidden="true"></span>=Modificar contactos, <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>= Modificar datos generales de empresa]
      </small>
  </h5>
  <form class="form-horizontal" action="privado.php?c=correo&a=mostrar" role="form" method="POST">
    <div class="row">
       <div class="col-lg-2">
        <button type="submit" class="btn btn-default btn-block col-lg-4" name="irMail">Crear Correo</button>
      </div>
    </div>
  <table class="table table-hover">
  <thead>
    <tr>
      <th>Nº Socio</th>
      <th>Denominacion</th>
      <th>Rubro</th>
      <th>Categoria</th>
      <th>Importe Mensual</th>
      <th>Contactos</th>
      <th>Medidor</th>
      <th>Abonado</th>
      <th>Activo</th>
      <th>Controles</th>
    </tr>
  </thead>
  <tbody>
    {% for item in empresas %}
     <input type="hidden" name="arrayIdempresa[]" value="{{item.idempresa}}" >
        <tr>
          <td>
           
            {% autoescape 'html' %}
              {{ item.idempresa|convert_encoding(from='iso-2022-jp', to='UTF-8') }}    
            {% endautoescape %}
          </td>
  </form>
          <td>
            {% autoescape 'html' %}
              {{ item.denominacion|convert_encoding(from='iso-2022-jp', to='UTF-8') }}    
            {% endautoescape %}
          </td>
          <td>
            {% autoescape 'html' %}
              {% for r in rubros %}
                {% if r.id == item.idrubro %}
                  {{r.descripcion|convert_encoding(from='iso-2022-jp', to='UTF-8') }}  
                {% endif %}
              {% endfor %}
            {% endautoescape %}
          </td>
          <td>
            {% autoescape 'html' %}
              {% for c in categorias %}
                {% if c.id == item.idcategoria %}
                  {{c.descripcion|convert_encoding(from='iso-2022-jp', to='UTF-8') }}  
                {% endif %}
              {% endfor %}
            {% endautoescape %}
          </td>
          <td>
            {% autoescape 'html' %}
              {{ item.importemensual|convert_encoding(from='iso-2022-jp', to='UTF-8') }}    
            {% endautoescape %}
          </td>
          <td>
            {% autoescape 'html' %}
               {% for i in arrayVista %}
                  {% if i['idempresa'] == item.idempresa %}
                    {% for contacto in i['contactos'] %}
                      <li> 
                        {% for cNom in contactos %}
                          {% if cNom.idcontacto == contacto.idcontacto %}
                            {{ cNom.apellido|convert_encoding(from='iso-2022-jp', to='UTF-8') }}
                          {% endif %}
                        {% endfor %}
                      </li>
                    {% endfor %}
                  {% endif %}  
              {% endfor %} 
            {% endautoescape %}
          </td>
           <td>
            {% autoescape 'html' %} 
          
               {% for i in arrayVista %}
                  {% if i['idempresa'] == item.idempresa %}
                        {% for mNom in medidores %}
                          {% if mNom.idmedidor == i['medidor'].idmedidor %}
                              <li> {{ mNom.nomyap|convert_encoding(from='iso-2022-jp', to='UTF-8') }}</li>
                          {% endif %}
                        {% endfor %}
                  {% endif %}  
                {% endfor %} 
              
            {% endautoescape %}
          </td>
          <td>
            {% for i in arrayVista %}
              {% if i['idempresa'] == item.idempresa %}
                <li> 
                  {% for mAbon in abonados %}
                    {% if mAbon.numabonado == i['abonado'].numabonado %}
                      {{ mAbon.numabonado|convert_encoding(from='iso-2022-jp', to='UTF-8') }}
                    {% endif %}
                  {% endfor %}
                </li>
              {% endif %}  
            {% endfor %} 
           </td>
          <td class="celda-numero">
            
              {% if item.activo == 1 %}
                Si   
              {% else %}
                No
              {% endif %}
          </td>
          <td class="controles">
            <!-- Ver empresa -->
            <form method="post" action="privado.php?c=empresa&a=detalle" id="verEmpresa{{item.idempresa}}">
                <input type="hidden" value="{{item.idempresa}}" name="id">
                <a href="javascript:{}" onclick="document.getElementById('verEmpresa{{item.idempresa}}').submit(); return false;">
                  <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                </a>
            </form>
             <!--Modificar correos-->
            <form method="post" action="privado.php?c=empresa&a=modificarCorreos" id="modificarCorreosEmpresa{{item.idempresa}}">
              <input type="hidden" value="{{item.idempresa}}" name="idempresa">
              <a href="javascript:{}" onclick="document.getElementById('modificarCorreosEmpresa{{item.idempresa}}').submit(); return false;">
                <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
              </a>
            </form>
            <!--Modificar domicilios-->
            <form method="post" action="privado.php?c=empresa&a=modificarDomicilios" id="modificarDomicilioEmpresa{{item.idempresa}}">
              <input type="hidden" value="{{item.idempresa}}" name="idempresa">
              <a href="javascript:{}" onclick="document.getElementById('modificarDomicilioEmpresa{{item.idempresa}}').submit(); return false;">
                <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
              </a>
            </form>
            <!--Modificar telefonos-->
            <form method="post" action="privado.php?c=empresa&a=modificarTelefonos" id="modificarTelefonoEmpresa{{item.idempresa}}">
              <input type="hidden" value="{{item.idempresa}}" name="idempresa">
              <a href="javascript:{}" onclick="document.getElementById('modificarTelefonoEmpresa{{item.idempresa}}').submit(); return false;">
                <span class="glyphicon glyphicon-earphone" aria-hidden="true"></span>
              </a>
            </form>
            <!--Modificar contactos-->
            <form method="post" action="privado.php?c=empresa&a=modificarContactos" id="modificarContactoEmpresa{{item.idempresa}}">
              <input type="hidden" value="{{item.idempresa}}" name="idempresa">
              <a href="javascript:{}" onclick="document.getElementById('modificarContactoEmpresa{{item.idempresa}}').submit(); return false;">
                <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
              </a>
            </form>
            <!--Modificar empresa-->
            <form method="post" action="privado.php?c=empresa&a=modificar" id="modificarEmpresa{{item.idempresa}}">
              <input type="hidden" value="{{item.idempresa}}" name="idempresa">
              <a href="javascript:{}" onclick="document.getElementById('modificarEmpresa{{item.idempresa}}').submit(); return false;">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
              </a>
            </form>
             <!--Eliminar empresa-->
            <form method="post" action="privado.php?c=empresa&a=baja" id="bajaEmpresa{{item.idempresa}}">
              <input type="hidden" value="{{item.idempresa}}" name="idempresa">
              <a href="javascript:{}" onclick="if(confirm('¿Está seguro que desea eliminar la empresa?')){document.getElementById('bajaEmpresa{{item.idempresa}}').submit();}">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
              </a>
            </form> 
          </td>
        </tr>
    {% endfor %}
  </tbody>
  </table>
 

{% endblock %}